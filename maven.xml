<?xml version="1.0" encoding="UTF-8"?>
<project default="jar"
	xmlns:j="jelly:core"
    xmlns:maven="jelly:maven"
    xmlns:deploy="deploy"
    xmlns:ant="jelly:ant">
    
    <goal name="setclasspath">
        <path id="test.classpath">
            <path refid="maven.dependency.classpath"/>
        </path>
    </goal>
    
    <postGoal name="test:compile">
    <mkdir dir="${basedir}/target/lib"/>
    <deploy:copy-deps todir="${basedir}/target/lib"/>

	<echo message="----------------Creating ActivationCoordinator.aar----------------"/>
	<mkdir dir="target/services/ActivationCoordinator/META-INF"/>
        <copy file="conf/ActivationCoordinator/META-INF/services.xml"
            tofile="target/services/ActivationCoordinator/META-INF/services.xml"/>
        <jar jarfile="target/ActivationCoordinator.aar" 			basedir="target/services/ActivationCoordinator">
            <include name="**"/>
        </jar>

	<echo message="----------------Creating AtomicTransactionCoordinator.aar----------------"/>
	<mkdir dir="target/services/AtomicTransactionCoordinator/META-INF"/>
        <copy file="conf/AtomicTransactionCoordinator/META-INF/services.xml"
            tofile="target/services/AtomicTransactionCoordinator/META-INF/services.xml"/>
        <jar jarfile="target/AtomicTransactionCoordinator.aar" 					basedir="target/services/AtomicTransactionCoordinator">
            <include name="**"/>
        </jar>


	<echo message="----------------Creating AtomicTransactionParticipant.aar----------------"/>
	<mkdir dir="target/services/AtomicTransactionParticipant/META-INF"/>
        <copy file="conf/AtomicTransactionParticipant/META-INF/services.xml"
            tofile="target/services/AtomicTransactionParticipant/META-INF/services.xml"/>
        <jar jarfile="target/AtomicTransactionParticipant.aar" 					basedir="target/services/AtomicTransactionParticipant">
            <include name="**"/>
        </jar>


	<echo message="----------------Creating CompletionCoordinator.aar----------------"/>
	<mkdir dir="target/services/CompletionCoordinator/META-INF"/>
        <copy file="conf/CompletionCoordinator/META-INF/services.xml"
            tofile="target/services/CompletionCoordinator/META-INF/services.xml"/>
        <jar jarfile="target/CompletionCoordinator.aar" 					basedir="target/services/CompletionCoordinator">
            <include name="**"/>
        </jar>


	<echo message="----------------Creating RegistrationCoordinator.aar----------------"/>
	<mkdir dir="target/services/RegistrationCoordinator/META-INF"/>
        <copy file="conf/RegistrationCoordinator/META-INF/services.xml"
            tofile="target/services/RegistrationCoordinator/META-INF/services.xml"/>
        <jar jarfile="target/RegistrationCoordinator.aar" 					basedir="target/services/RegistrationCoordinator">
            <include name="**"/>
        </jar>

	<echo message="----------------Creating Kandula-inflow.mar----------------"/>
	<mkdir dir="target/modules/kandula-inflow/META-INF"/>
        <copy file="conf/inflow-module.xml"
            tofile="target/modules/kandula-inflow/META-INF/module.xml"/>
        <jar jarfile="target/kandula-inflow-0.1.mar" 	basedir="target/modules/kandula-inflow">
            <include name="**"/>
        </jar>

	<echo message="----------------Creating Kandula-outflow.mar----------------"/>
	<mkdir dir="target/modules/kandula-outflow/META-INF"/>
        <copy file="conf/outflow-module.xml"
            tofile="target/modules/kandula-outflow/META-INF/module.xml"/>
        <jar jarfile="target/kandula-outflow-0.1.mar" 	basedir="target/modules/kandula-outflow">
            <include name="**"/>
        </jar>


	<echo message="-----------Creating Coordinator+participant test repository----------"/>
	<mkdir dir="target/testing-repository"/>
        <copy file="target/ActivationCoordinator.aar"
            tofile="target/testing-repository/services/ActivationCoordinator.aar"/>
	 <copy file="target/AtomicTransactionCoordinator.aar"
            tofile="target/testing-repository/services/AtomicTransactionCoordinator.aar"/>
	 <copy file="target/AtomicTransactionParticipant.aar"
            tofile="target/testing-repository/services/AtomicTransactionParticipant.aar"/>
	 <copy file="target/CompletionCoordinator.aar"
            tofile="target/testing-repository/services/CompletionCoordinator.aar"/>
	 <copy file="target/RegistrationCoordinator.aar"
            tofile="target/testing-repository/services/RegistrationCoordinator.aar"/>
         <mkdir dir="target/testing-repository/modules"/>
	 <copy file="target/kandula-inflow-0.1.mar"
            tofile="target/testing-repository/modules/kandula-inflow-0.1.mar"/>
	 <copy file="modules/addressing-0.95-SNAPSHOT.mar"
            tofile="target/testing-repository/modules/addressing-0.95-SNAPSHOT.mar"/>
	 <copy file="conf/coordinator-axis2.xml"
            tofile="target/testing-repository/axis2.xml"/>

	<echo message="----------------Creating KandulaDemoService.aar----------------"/>
  <ant:copy todir="${samples.dir}/version/src">
            <ant:fileset dir="src">
                <ant:include name="sample/axisversion/**"/>
            </ant:fileset>
        </ant:copy>
	<mkdir dir="target/services/KandulaDemoService/META-INF"/>
        <copy file="test-resources/KandulaDemoService/META-INF/services.xml"
            tofile="target/services/KandulaDemoService/META-INF/services.xml"/>
        <jar jarfile="target/KandulaDemoService.aar" basedir="target/services/KandulaDemoService">
            <include name="**"/>
        </jar>
	<copy file="target/KandulaDemoService.aar"
            tofile="target/testing-repository/services/KandulaDemoService.aar"/>
        
	<echo message="-----------Creating Initiator test repository----------"/>
        <mkdir dir="target/initiator-repository"/>
	<mkdir dir="target/initiator-repository/modules"/>
	<copy file="target/kandula-outflow-0.1.mar"
            tofile="target/initiator-repository/modules/kandula-outflow-0.1.mar"/>
 	<copy file="modules/addressing-0.95-SNAPSHOT.mar"
            tofile="target/initiator-repository/modules/addressing-0.95-SNAPSHOT.mar"/>
	 <copy file="conf/initiator-axis2.xml"
            tofile="target/initiator-repository/axis2.xml"/>       
       
    </postGoal>
    
</project>
